(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[783],{4023:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat/[matchId]",function(){return a(9226)}])},9226:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var s=a(5893),r=a(7294),n=a(1163),l=a(9828),o=a(3977),i=a(6689);let c=(0,o.ZF)({apiKey:"AIzaSyBh5ET8InC-485lsXIwoeyMOpNlwHMTEB0",authDomain:"fightmatch-45bf4.firebaseapp.com",projectId:"fightmatch-45bf4",storageBucket:"fightmatch-45bf4.firebasestorage.app",messagingSenderId:"897012307107",appId:"1:897012307107:web:ccdfc963cf572a1ae05b16",measurementId:"G-WKBYC9BL4T"}),d=(0,l.ad)(c);function m(){let e=(0,n.useRouter)(),{matchId:t}=e.query,[a,o]=(0,r.useState)([]),[i,c]=(0,r.useState)(""),[m,u]=(0,r.useState)(!1),[h,x]=(0,r.useState)(null),f=(0,r.useRef)(null),g=()=>{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{g()},[a]),(0,r.useEffect)(()=>{t&&(async()=>{try{let e=localStorage.getItem("access_token"),a=await fetch("https://fightmatch-backend.onrender.com/users/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});if(a.ok){let e=await a.json();x(e)}}catch(e){console.error("Error fetching user:",e)}})()},[t]),(0,r.useEffect)(()=>{if(!t)return;let e=parseInt(localStorage.getItem("user_id"));if(!e){console.error("No user_id in localStorage");return}let a="chat_".concat(Math.min(e,parseInt(t)),"_").concat(Math.max(e,parseInt(t))),s=(0,l.hJ)(d,"conversations",a,"messages"),r=(0,l.IO)(s,(0,l.Xo)("timestamp","asc")),n=(0,l.cf)(r,e=>{let t=[];e.forEach(e=>{var a;let s=e.data();t.push({id:e.id,...s,timestamp:null===(a=s.timestamp)||void 0===a?void 0:a.toDate()})}),o(t)},e=>{console.error("Error listening to messages:",e)});return()=>n()},[t]);let p=async()=>{if(i.trim()){u(!0);try{let e=localStorage.getItem("access_token"),a=await fetch("https://fightmatch-backend.onrender.com/messages/send",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({match_id:parseInt(t),content:i})});if(a.ok)c("");else{let e=await a.json();alert(e.detail||"Failed to send message")}}catch(e){console.error("Error sending message:",e),alert("Failed to send message")}finally{u(!1)}}},b=parseInt(localStorage.getItem("user_id"));return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-900 flex flex-col",children:[(0,s.jsx)("div",{className:"bg-gray-800 p-4 border-b border-gray-700",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center gap-4",children:[(0,s.jsx)("button",{onClick:()=>e.back(),className:"text-white hover:text-gray-300",children:"← Back"}),h&&(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[h.profile_pic&&(0,s.jsx)("img",{src:h.profile_pic,alt:h.username,className:"w-10 h-10 rounded-full object-cover"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-white font-semibold",children:h.username}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:h.skill_level})]})]})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[0===a.length?(0,s.jsx)("div",{className:"text-center text-gray-500 py-8",children:"No messages yet. Start the conversation! \uD83E\uDD4A"}):a.map(e=>{let t=e.sender_id===b;return(0,s.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-3 rounded-2xl ".concat(t?"bg-red-600 text-white rounded-br-none":"bg-gray-700 text-white rounded-bl-none"),children:[!t&&(0,s.jsx)("p",{className:"text-xs text-gray-300 mb-1 font-semibold",children:e.sender_name}),(0,s.jsx)("p",{className:"break-words",children:e.content}),e.timestamp&&(0,s.jsx)("p",{className:"text-xs text-gray-300 mt-1 opacity-70",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)}),(0,s.jsx)("div",{ref:f})]})}),(0,s.jsx)("div",{className:"bg-gray-800 p-4 border-t border-gray-700",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p())},placeholder:"Type a message...",disabled:m,className:"flex-1 bg-gray-700 text-white rounded-full px-6 py-3 focus:outline-none focus:ring-2 focus:ring-red-600"}),(0,s.jsx)("button",{onClick:p,disabled:!i.trim()||m,className:"bg-red-600 text-white px-8 py-3 rounded-full hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors font-semibold",children:m?"Sending...":"Send"})]})})]})}(0,i.cF)(c)}},function(e){e.O(0,[703,38,888,774,179],function(){return e(e.s=4023)}),_N_E=e.O()}]);